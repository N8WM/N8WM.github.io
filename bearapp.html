<!DOCTYPE html>
<html>
  <head>
    
    <title>BEAR Test</title>
    
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    
    <!-- ======= ICONS ======= -->
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />
    <link rel="apple-touch-icon" href="/apple-touch-icon.png" />
    <link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png" />
    <link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png" />
    <link rel="apple-touch-icon" sizes="76x76" href="/apple-touch-icon-76x76.png" />
    <link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png" />
    <link rel="apple-touch-icon" sizes="120x120" href="/apple-touch-icon-120x120.png" />
    <link rel="apple-touch-icon" sizes="144x144" href="/apple-touch-icon-144x144.png" />
    <link rel="apple-touch-icon" sizes="152x152" href="/apple-touch-icon-152x152.png" />
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon-180x180.png" />
    
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    
    <!-- ======= WEBAPP ======= -->
    <meta name="apple-mobile-web-app-title" content="BEAR Test">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    
    <meta name="viewport" content="width=device-width, user-scalable=no">
    
    <link rel="stylesheet" href="/bearapp.css">
    
  </head>
  <body onload="init();">
    <center>
      <div id="bod">
        <div class="page" id="clock">
          <!-- ======= TIME INDICATOR ======= -->
          <br><br><div id="duration"></div><br><br>

          <!-- ======= CLOCK IN/OUT BUTTON ======= -->
          <button id="clock_io" ontouchstart="press();" ontouchend="release();"></button>
        </div>
        <div class="page" id="info_clocko">
          calendar or clock-out stuff
        </div>
        <div id="page_select">
          <div id="clock-select" onclick="pageSwitch('L')">
            <span class="vert-mid"><i class="material-icons" style="font-size: 300%;">schedule</i></span>
          </div>
          <div id="info_clocko-select" onclick="pageSwitch('R')">
            <span class="vert-mid"><i class="material-icons" style="font-size: 300%;">event</i></span>
          </div>
        </div>
        <div id="darkener"></div>
      </div>
    </center>
    <script>
      
      function init() {
        
        var t = new Date();
        var btn = document.getElementById("clock_io");
        var duration = document.getElementById("duration");
        
        pageSwitch("L");
        
        // ======= Initialize item "clock" if not already =======
        if (localStorage.getItem("clock") === null) {
          
          localStorage.setItem("clock", "false");              // If "clock" does not exist, set to false
        }
        
        // ======= Button says "clock in" if not yet clocked in =======
        // ======= Button says "clock out" if already clocked in =======
        if (localStorage.getItem("clock") === ("false")) {   // If not yet clocked in...
          
          btn.innerHTML = "Clock In";                          // ...then button says "clock in"
          btn.style.backgroundColor = "#7FFF00";
          btn.style.width = getTextWidth("Clock Out", {'font-family': 'sans-serif', 'font-size': '200%'}) + "px";
        }
        else {                                                 // If already clocked in...
          
          btn.innerHTML = "Clock Out";                         // ...then button says "clock out"
          btn.style.backgroundColor = "#DC143C";
          btn.style.width = getTextWidth("Clock Out", {'font-family': 'sans-serif', 'font-size': '200%'}) + "px";
          clock_in();
        }
        
        setInterval(refresh, 100);
      }
      
      function refresh() {
        
        var t = new Date();
        var btn = document.getElementById("clock_io");
        var duration = document.getElementById("duration");
        
        // ======= Detect duration =======
        if (localStorage.getItem("clock") === ("false")) {   // If not yet clocked in...
          
          duration.innerHTML = "Not Clocked In";               // ...say so
        }
        else {                                                 // If clocked in...
          
          var duration_ms = t.getTime() - parseInt(localStorage.getItem("clock"));
          var sec_val = Math.floor(duration_ms / 1000) % 60;
          var sec_str = (sec_val >= 10)?(sec_val + ""):("0" + sec_val);
          var min_val = Math.floor((duration_ms / 1000) / 60) % 60;                              // ...display time elapsed
          var min_str = (min_val >= 10)?(min_val + ""):("0" + min_val);
          var hr_val  = Math.floor(((duration_ms / 1000) / 60) / 60);
          var duration_str = hr_val + ":" + min_str + ":" + sec_str;
          
          duration.innerHTML = duration_str;
        }
      }
      
      function press() {
        
        var btn = document.getElementById("clock_io");
        btn.style.width = "90%";
      }
      
      function release() {
        
        var t = new Date();
        
        var btn = document.getElementById("clock_io");
        btn.style.width = getTextWidth("Clock Out", {'font-family': 'sans-serif', 'font-size': '200%'}) + "px";
        
        if (localStorage.getItem("clock") === ("false")) {
          
          localStorage.setItem("clock", t.getTime());
          btn.innerHTML = "Clock Out";
          btn.style.backgroundColor = "#DC143C";
          clock_in();
        }
        else {
          
          localStorage.setItem("start", localStorage.getItem("clock"));
          localStorage.setItem("end", t.getTime());
          localStorage.setItem("clock", "false");
          btn.innerHTML = "Clock In";
          btn.style.backgroundColor = "#7FFF00";
          clock_out();
        }
      }
      
      function clock_in() {
        
        // nothing yet
      }
      
      function clock_out() {
        
        pageSwitch("R");
      }
      
      function pageSwitch(side) {
        
        var clock = document.getElementById("clock");
        var info_clocko = document.getElementById("info_clocko");
        var darkener = document.getElementById("darkener");
        
        if (side === "L") {
          
          clock.style.left = "0";
          info_clocko.style.left = "100%";
          darkener.style.left = "0";
        }
        
        else if (side === "R") {
          
          clock.style.left = "-100%";
          info_clocko.style.left = "0";
          darkener.style.left = "50%";
        }
        
        else {
          if (clock.style.left === "0") {

            pageSwitch("R");
          }

          else {

            pageSwitch("L");
          }
        }
      }
      
      function getTextWidth(text, css) {
        var e = $('<span></span>'); // dummy element
        e.css(css); // set properties
        e.text(text); // set test
        var width = e.appendTo($('body')).width(); // append and get width
        e.remove(); // remove from DOM
        return width + 25;
      }
      
    </script>
  </body>
</html>
