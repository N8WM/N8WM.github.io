<!DOCTYPE html>
<html>
  <head>
    
    <title>BEAR Test</title>
    
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    
    <!-- ======= ICONS ======= -->
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />
    <link rel="apple-touch-icon" href="/apple-touch-icon.png" />
    <link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png" />
    <link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png" />
    <link rel="apple-touch-icon" sizes="76x76" href="/apple-touch-icon-76x76.png" />
    <link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png" />
    <link rel="apple-touch-icon" sizes="120x120" href="/apple-touch-icon-120x120.png" />
    <link rel="apple-touch-icon" sizes="144x144" href="/apple-touch-icon-144x144.png" />
    <link rel="apple-touch-icon" sizes="152x152" href="/apple-touch-icon-152x152.png" />
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon-180x180.png" />
    
    <!-- ======= WEBAPP ======= -->
    <meta name="apple-mobile-web-app-title" content="BEAR Test">
    <meta name="apple-mobile-web-app-capable" content="yes">
    
    <meta name="viewport" content="width=device-width, user-scalable=no">
    
    <link rel="stylesheet" href="/bearapp.css">
    
  </head>
  <body onload="init();">
    <center>
      <!-- ======= TIME INDICATOR ======= -->
      <br><br><div id="duration"></div><br><br>

      <!-- ======= CLOCK IN/OUT BUTTON ======= -->
      <button id="clock_io" onmousedown="press();" onmouseup="release();"></button><br><br><br><br>
      <div id="c_i"></div>
    </center>
    <script>
      
      function init() {
        
        var t = new Date();
        var btn = document.getElementById("clock_io");
        var duration = document.getElementById("duration");
        
        // ======= Initialize item "clock" if not already =======
        if (localStorage.getItem("clock") === null) {
          
          localStorage.setItem("clock", "false");              // If "clock" does not exist, set to false
        }
        
        // ======= Button says "clock in" if not yet clocked in =======
        // ======= Button says "clock out" if already clocked in =======
        if (localStorage.getItem("clock") === ("false")) {   // If not yet clocked in...
          
          btn.innerHTML = "Clock In";                          // ...then button says "clock in"
          btn.style.backgroundColor = "chartreuse";
          btn.style.width = getTextWidth("Clock Out", {'font-family': 'sans-serif', 'font-size': '200%'}) + "px";
        }
        else {                                                 // If already clocked in...
          
          btn.innerHTML = "Clock Out";                         // ...then button says "clock out"
          btn.style.backgroundColor = "crimson";
          btn.style.width = getTextWidth("Clock Out", {'font-family': 'sans-serif', 'font-size': '200%'}) + "px";
        }
        
        setInterval(refresh, 5);
      }
      
      function refresh() {
        
        var t = new Date();
        var btn = document.getElementById("clock_io");
        var duration = document.getElementById("duration");
        
        // ======= Detect duration =======
        if (localStorage.getItem("clock") === ("false")) {   // If not yet clocked in...
          
          duration.innerHTML = "Not Clocked In";               // ...say so
        }
        else {                                                 // If clocked in...
          
          var duration_ms = t.getTime() - parseInt(localStorage.getItem("clock"));
          var sec_val = Math.floor(duration_ms / 1000) % 60;
          var sec_str = (sec_val >= 10)?(sec_val + ""):("0" + sec_val);
          var min_val = Math.floor((duration_ms / 1000) / 60) % 60;                              // ...display time elapsed
          var min_str = (min_val >= 10)?(min_val + ""):("0" + min_val);
          var hr_val  = Math.floor(((duration_ms / 1000) / 60) / 60);
          var duration_str = hr_val + ":" + min_str + ":" + sec_str;
          
          duration.innerHTML = duration_str;
        }
      }
      
      function press() {
        
        var btn = document.getElementById("clock_io");
        btn.style.width = "90%";
      }
      
      function release() {
        
        var t = new Date();
        
        var btn = document.getElementById("clock_io");
        btn.style.width = getTextWidth("Clock Out", {'font-family': 'sans-serif', 'font-size': '200%'}) + "px";
        
        if (localStorage.getItem("clock") === ("false")) {
          
          localStorage.setItem("clock", t.getTime());
          btn.innerHTML = "Clock Out";
          btn.style.backgroundColor = "crimson";
          clock_in();
        }
        else {
          
          localStorage.setItem("clock", "false");
          btn.innerHTML = "Clock In";
          btn.style.backgroundColor = "chartreuse";
          clock_out();
        }
      }
      
      function clock_in() {
        
        var u_input = document.getElementById("c_i");
        u_input.innerHTML = "<div class='title'>Enter Job Description</div><br><br><textarea id='clock_out_info'></textarea>";
      }
      
      function clock_out() {
        
        var u_input = document.getElementById("c_i");
        u_input.innerHTML = "";
      }
      
      function getTextWidth(text, css) {
        var e = $('<span></span>'); // dummy element
        e.css(css); // set properties
        e.text(text); // set test
        var width = e.appendTo($('body')).width(); // append and get width
        e.remove(); // remove from DOM
        return width + 25;
      }
      
    </script>
  </body>
</html>
